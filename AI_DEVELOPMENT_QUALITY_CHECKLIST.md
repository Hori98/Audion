# 🎯 Audion AI開発品質保証チェックリスト v3.0 (ULTRA ENHANCED)

**基本理念**: このチェックリストはCLAUDE.mdの「三位一体の開発原則」に基づき、**人間の意思決定**、**Claude Codeの分析と実行**、**Gemini MCPの検証と助言**の協業による開発品質を最大化します。

---

## 📋 実行プロトコル：必須作業フロー

### すべてのタスク開始時の出力テンプレート
```
PLAN:
- 目的: [1行で明確に]
- 影響範囲: [修正するファイル/関数を列挙]
- 契約変更: [API/型/DBスキーマの変更有無]
- テスト方針: [何をどうテストするか]
- 非ゴール: [今回やらないこと]
```

### すべてのタスク完了時の出力テンプレート
```
SUMMARY:
- 実施内容: [実際に変更した内容]
- 影響確認: [他への波及確認結果]
- テスト結果: [実行したテスト結果]
- 未解決事項: [残っている課題・次回対応要]
```

---

## Phase 1: 👨‍💻 人間による計画・意思決定 (Human-led Planning)

**重要**: AIに指示を出す前に、人間が責任を持って実施する必須項目

### 1.1. 戦略・目的定義 ⭐⭐⭐⭐⭐

| チェック項目 | 詳細確認内容 | 危険回避 |
|------------|-------------|---------|
| **目的の明確化** | このタスクの最終的なゴールは何か？ | 曖昧な指示による実装の迷走を防止 |
| **UX要求の定義** | ユーザー体験として何を実現したいか？（核心レイヤーの言語化） | 技術手段への局所最適化を防止 |
| **非ゴールの設定** | 今回のタスクで「やらないこと」は何か？ | スコープクリープとAI暴走防止 |

### 1.2. 影響範囲確認プロトコル（必須100%実行） ⭐⭐⭐⭐⭐

**CRITICAL**: 修正したらその箇所だけで完了と判断するな。以下を必ず実行せよ：

| チェック項目 | 実行コマンド | 合格条件 |
|------------|-------------|---------|
| **情報ソース優先度プロトコル** | コードベース確認を最優先（外部AI情報は参考程度） | ✅ 実装詳細をコードで確認済み |
| **データフロー追跡** | `grep -r "変更対象の変数/関数名" . --include="*.tsx" --include="*.ts" --include="*.py"` | ✅ すべての参照箇所を特定 |
| **API契約変更の有無** | フロントエンド・バックエンド間のAPI仕様変更有無 | ✅ リクエスト/レスポンス型の整合性確保 |
| **DBスキーマ変更の有無** | データベース構造への影響分析 | ✅ マイグレーション計画策定済み |
| **共通機能の統合** | `grep -r "類似ロジック" . --include="*.tsx" --include="*.py"` | ✅ 重複実装の共通化検討済み |

### 1.3. AIへの指示設計（AI暴走防止） ⭐⭐⭐⭐⭐

**良い指示の例**:
```
「UserAuthServiceのパスワード変更機能で、以下の要件を満たすメソッドを実装してください：
1. 現在のパスワード検証
2. 新パスワードの強度チェック
3. ハッシュ化して保存
4. セッション無効化
実装前に設計案を提示し、承認を得てから着手してください。」
```

**危険な指示（禁止）**:
- ❌「認証周りのバグを全部直して」
- ❌「パフォーマンスを改善して」
- ❌「UIを綺麗にして」

| チェック項目 | 検証内容 | 
|------------|---------|
| **具体的指示** | スコープが限定され、成果物が明確か？ |
| **AIの役割分担** | Claude Code（実行）、Gemini MCP（検証）の役割は明確か？ |
| **承認プロセス** | 「実装前に設計案を提示」等、区切り指示を含むか？ |

---

## Phase 2: 🤖 AI による実装・分析 (AI-driven Implementation)

**重要**: AIがコードを生成・変更した直後に検証する必須項目

### 2.1. AIガードレール・暴走防止チェック（ポストフライト） ⭐⭐⭐⭐⭐

| チェック項目 | 検証方法 | 緊急対応 |
|------------|---------|---------|
| **意図通りの変更** | 生成コードが指示範囲・意図に収まっているか？ | 範囲外変更時は即座に `git revert` |
| **禁止範囲の不変更** | 認証・環境設定・テスト削除などの禁止変更がないか？ | 禁止変更検出時は変更破棄・修正 |
| **影響範囲外への変更なし** | PLANで定義した範囲外ファイルの変更がないか？ | 意図しない変更は即座に取り消し |

### 2.2. 自動品質検証の実行 ⭐⭐⭐⭐⭐

**変更保存時に必ず実行**:
```bash
# 品質検証スクリプト
python quality_validator.py

# フロントエンド検証
cd audion-app
npm run lint          # ESLint実行
npx tsc --noEmit      # TypeScript型チェック

# バックエンド検証  
cd backend
python -m pytest tests/  # 単体テスト実行
python -m mypy .          # 型チェック実行
```

**いずれか失敗時は変更を破棄・修正してから再実行**

### 2.3. Audion固有ベストプラクティス遵守 ⭐⭐⭐⭐

| 項目 | 確認内容 | Audion特有の作法 |
|-----|---------|-----------------|
| **音声生成API** | `backend/routers/audio_unified.py`の統合エンドポイント使用 | 旧API（`/api/audio/create`）使用禁止 |
| **設定システム** | `audion-app/services/SettingsService.ts`に集約 | AsyncStorage直接操作禁止 |
| **認証** | `audion-app/context/AuthContext.tsx`経由必須 | JWT Token直接操作禁止 |
| **契約ファースト開発** | API変更時はbackend定義→API確認→frontend実装の順序 | フロントエンド先行実装禁止 |
| **段階的実装** | 新機能はフィーチャーフラグで保護 | 本番直接リリース禁止 |

---

## Phase 3: 🧐 Gemini-MCP & 人間による検証 (Verification & Review)

**重要**: 機能として完成し、コミットする前の最終確認項目

### 3.1. 機能・UX検証 ⭐⭐⭐⭐⭐

| チェック項目 | 検証内容 |
|------------|---------|
| **要件の充足** | Phase 1で定義した目的・UX要求を満たしているか？ |
| **手動テスト** | 正常系・異常系の両方で動作確認完了？ |
| **クロスプラットフォーム確認** | iOS/Android/Webでの表示・動作に問題なし？ |
| **エラーハンドリング** | ユーザー向けエラーメッセージが適切？ |

### 3.2. テストとドキュメント ⭐⭐⭐⭐

| チェック項目 | 基準 |
|------------|-----|
| **テストの追加・更新** | 変更箇所に対するテストが追加・更新済み？ |
| **テストカバレッジ** | カバレッジが85%以上を維持？ |
| **統合テスト** | 主要ユーザーフローのテストが完了？ |
| **ドキュメント更新** | README.md、APIドキュメント更新済み？ |

### 3.3. コミット準備・品質ゲート ⭐⭐⭐⭐⭐

```yaml
# 品質ゲート - すべて100%必須
quality_gates:
  - name: "ルーティング検証"
    command: "python routing_validator.py" 
    threshold: "100%"
    blocking: true
    
  - name: "環境変数検証"
    command: "python env_validator.py --strict"
    threshold: "100%" 
    blocking: true
    
  - name: "テストカバレッジ"
    command: "pytest --cov=. --cov-fail-under=85"
    threshold: "85%"
    blocking: true
    
  - name: "統合テスト"
    command: "python integration_test_suite.py" 
    threshold: "100%"
    blocking: true
```

| チェック項目 | 確認内容 |
|------------|---------|
| **意味のあるコミット** | 1機能・修正 = 1コミット？ |
| **明確なコミットメッセージ** | 変更の「なぜ」と「何を」が記述済み？ |
| **緊急事故対応準備** | `git revert`で即座に復旧可能？ |

---

## 🚨 緊急事故対応プロトコル

**変更により既存機能が動かなくなった場合**:
1. 即座に変更を `git revert` で取り消し
2. 原因調査前に**まず復旧優先**
3. 影響範囲の再調査・テスト追加後に再実装

---

## 🎯 AI協業における品質KPI

### 継続監視指標
- **ルーティング整合性**: 100%（重複・不整合ゼロ）
- **API契約遵守率**: 100%（OpenAPI仕様と実装の完全一致）
- **環境変数完全性**: 100%（必須変数の完全設定）
- **テストカバレッジ**: 85%以上
- **統合テスト成功率**: 100%
- **AI指示の明確性**: 危険な指示パターンゼロ
- **影響範囲確認実行率**: 100%

### 自動修正プロトコル
```python
auto_fix_protocols = {
    'api_path_duplication': lambda: fix_api_path_duplication(),
    'cors_error': lambda: configure_cors_settings(), 
    'env_var_missing': lambda: generate_env_template(),
    'test_coverage_low': lambda: generate_missing_tests(),
    'ai_guardrail_violation': lambda: revert_and_analyze()
}
```

**このチェックリストにより、CLAUDE.mdの高度な開発哲学が日々の開発業務に根付いた実践的な品質保証システムとして機能し、AI開発でも最高水準の品質・安定性を実現します。**